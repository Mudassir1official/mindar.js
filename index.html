<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Business Card</title>
    <style>
      html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; background: transparent; }
      .loading { position: fixed; inset: 0; display: grid; place-items: center; color: #fff; font: 16px/1.4 system-ui, sans-serif; }
      .loading[hidden] { display: none; }
    </style>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- MindAR for A-Frame -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>
    <script>
      // Simple clickable link component
      AFRAME.registerComponent('link-button', {
        schema: { url: {type: 'string'}, label: {type: 'string', default: ''} },
        init() {
          const el = this.el;
          el.classList.add('clickable');
          el.setAttribute('geometry', 'primitive: plane; width: 0.52; height: 0.14');
          el.setAttribute('material', 'color: #ffffff; opacity: 0.95; shader: flat');
          // label
          const text = document.createElement('a-text');
          text.setAttribute('value', this.data.label || this.data.url);
          text.setAttribute('color', '#222');
          text.setAttribute('align', 'center');
          text.setAttribute('width', 1.5);
          text.setAttribute('position', '0 0 0.01');
          el.appendChild(text);
          // hover feedback
          el.addEventListener('mouseenter', () => el.setAttribute('material', 'color: #e6e6e6; opacity: 1; shader: flat'));
          el.addEventListener('mouseleave', () => el.setAttribute('material', 'color: #ffffff; opacity: 0.95; shader: flat'));
          // click → open link
          el.addEventListener('click', () => {
            const url = this.data.url;
            if (url) window.open(url, '_blank');
          });
        }
      });

      // Generic open-url to attach to any entity (e.g., icon planes)
      AFRAME.registerComponent('open-url', {
        schema: { url: { type: 'string' } },
        init() {
          this.el.classList.add('clickable');
          this.el.addEventListener('click', () => {
            if (this.data.url) window.open(this.data.url, '_blank');
          });
        }
      });
    </script>
  </head>
  <body>
    <div id="loading" class="loading">Loading AR… Point the camera at your business card target.</div>

    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: true; uiLoading: no; uiScanning: yes; uiError: yes;"
      renderer="alpha: true; antialias: true; precision: mediump"
      color-space="sRGB"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      embedded
    >
      <a-assets timeout="15000">
        <!-- Autoplaying promo video (muted + playsinline required for mobile) -->
        <video id="promo" src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" autoplay loop muted playsinline webkit-playsinline crossorigin="anonymous"></video>
        <!-- Animated 3D model (Fox with built-in animations) -->
        <a-asset-item id="fox" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Fox/glTF-Binary/Fox.glb"></a-asset-item>
      </a-assets>

      <!-- Anchor to target 0 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <!-- Card background -->
        <a-plane width="1.8" height="1.05" color="#1f1f1f" opacity="0.92" position="0 0 0" material="shader: flat"></a-plane>

        <!-- Soft lights for 3D model -->
        <a-entity light="type: ambient; intensity: 0.9" position="0 1 0"></a-entity>
        <a-entity light="type: directional; intensity: 0.8" position="0.4 1 0.6"></a-entity>

        <!-- Avatar placeholder -->
        <a-circle radius="0.12" color="#ffffff" position="-0.75 0.28 0.01"></a-circle>
        <a-circle radius="0.11" color="#8888ff" position="-0.75 0.28 0.015"></a-circle>

        <!-- Name and title -->
        <a-text value="Your Name" position="-0.55 0.33 0.01" color="#fff" width="2" align="left"></a-text>
        <a-text value="Your Title" position="-0.55 0.18 0.01" color="#d9d9d9" width="2" align="left"></a-text>

        <!-- Video panel -->
        <a-video src="#promo" width="0.9" height="0.5" position="-0.35 0.0 0.02"></a-video>

        <!-- Animated model on the right -->
        <a-entity position="0.75 -0.05 0.03" rotation="0 -25 0" scale="0.35 0.35 0.35">
          <a-gltf-model src="#fox" animation-mixer="clip: Walk; loop: repeat; timeScale: 1"></a-gltf-model>
        </a-entity>

        <!-- Buttons (text buttons) -->
        <a-entity link-button="url: https://your-website.com; label: Website" position="-0.15 -0.02 0.02"></a-entity>
        <a-entity link-button="url: https://twitter.com/yourhandle; label: Twitter" position="0.45 -0.02 0.02"></a-entity>

        <!-- Social icons row (clickable colored tiles) -->
        <a-entity position="0 -0.42 0.03">
          <!-- Instagram -->
          <a-entity geometry="primitive: plane; width: 0.36; height: 0.16" material="color: #E1306C; opacity: 0.95; shader: flat" position="-0.6 0 0" open-url="url: https://instagram.com/yourhandle">
            <a-text value="Instagram" color="#fff" align="center" width="1.5" position="0 0 0.01"></a-text>
          </a-entity>
          <!-- LinkedIn -->
          <a-entity geometry="primitive: plane; width: 0.36; height: 0.16" material="color: #0A66C2; opacity: 0.95; shader: flat" position="0 0 0" open-url="url: https://www.linkedin.com/in/yourhandle">
            <a-text value="LinkedIn" color="#fff" align="center" width="1.5" position="0 0 0.01"></a-text>
          </a-entity>
          <!-- Twitter/X -->
          <a-entity geometry="primitive: plane; width: 0.36; height: 0.16" material="color: #1DA1F2; opacity: 0.95; shader: flat" position="0.6 0 0" open-url="url: https://twitter.com/yourhandle">
            <a-text value="Twitter" color="#fff" align="center" width="1.5" position="0 0 0.01"></a-text>
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- Camera + cursor for clicking -->
      <a-camera position="0 0 0" look-controls="enabled: false">
        <a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
      </a-camera>
    </a-scene>

    <script>
      // Hide loader when scene is ready
      const loading = document.getElementById('loading');
      window.addEventListener('load', () => {
        const scene = document.querySelector('a-scene');
        if (scene?.hasLoaded) loading.hidden = true; else scene?.addEventListener('loaded', () => loading.hidden = true);
      });
    </script>
  </body>
</html>
