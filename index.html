<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>MindAR Social Card</title>
    <style>
      html, body { margin: 0; padding: 0; overflow: hidden; background: #000; }
      /* Hide VR button */
      .a-enter-vr-button { display: none !important; }
    </style>
    <!-- A-Frame + MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <body>
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; filterMinCF: 0.01; filterBeta: 0.01"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights: true"
      embedded
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true">

      <a-assets>
        <!-- Your 3D model -->
        <a-asset-item id="avatarModel" src="./base.glb"></a-asset-item>
        <!-- Replace with your file or URL -->
        <video id="promoVideo" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" preload="auto" loop playsinline webkit-playsinline muted crossorigin="anonymous"></video>
      </a-assets>

      <!-- Mouse/touch cursor for clicking in AR -->
      <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse"></a-camera>

      <!-- Anchor for the first target in targets.mind -->
      <a-entity id="anchor" mindar-image-target="targetIndex: 0">
        <!-- Video plane on the card -->
        <a-plane id="videoPlane"
                 position="0 0 0"
                 width="1.25" height="0.70"
                 material="shader: flat; src: #promoVideo">
        </a-plane>

        <!-- 3D model at the right side, with a slow idle spin (if your GLB has its own animations, the mixer will play them) -->
        <a-gltf-model id="model" src="#avatarModel" position="0.85 -0.05 0.15" rotation="0 0 0" scale="0.25 0.25 0.25" animation-mixer></a-gltf-model>

        <!-- Social buttons row under the video -->
        <a-entity position="0 -0.65 0.02">
          <!-- Instagram -->
          <a-entity position="-0.55 0 0">
            <a-plane id="btnInsta" class="clickable" width="0.30" height="0.30" color="#E1306C"></a-plane>
            <a-text value="IG" color="#fff" align="center" position="0 0 0.01" width="0.6"></a-text>
          </a-entity>
          <!-- LinkedIn -->
          <a-entity position="-0.15 0 0">
            <a-plane id="btnLinkedin" class="clickable" width="0.30" height="0.30" color="#0A66C2"></a-plane>
            <a-text value="in" color="#fff" align="center" position="0 0 0.01" width="0.6"></a-text>
          </a-entity>
          <!-- Twitter/X -->
          <a-entity position="0.25 0 0">
            <a-plane id="btnTwitter" class="clickable" width="0.30" height="0.30" color="#1DA1F2"></a-plane>
            <a-text value="X" color="#fff" align="center" position="0 0 0.01" width="0.6"></a-text>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // Play/pause the video when the image target is found/lost
      const anchor = document.querySelector('#anchor');
      const video = document.querySelector('#promoVideo');

      // Ensure autoplay starts after any first user gesture on iOS
      const ensurePlay = () => { video.play().catch(() => {}); window.removeEventListener('click', ensurePlay); };
      window.addEventListener('click', ensurePlay, { once: true });

      anchor.addEventListener('targetFound', () => {
        video.play().catch(() => {});
      });
      anchor.addEventListener('targetLost', () => {
        video.pause();
      });

      // Simple idle rotation in case the GLB has no built-in animation
      const model = document.getElementById('model');
      model.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 12000; easing: linear');

      // Click handlers for social buttons
      const openURL = (url) => window.open(url, '_blank');
      document.getElementById('btnInsta').addEventListener('click', () => openURL('https://instagram.com/YOUR_USERNAME'));
      document.getElementById('btnLinkedin').addEventListener('click', () => openURL('https://www.linkedin.com/in/YOUR_USERNAME'));
      document.getElementById('btnTwitter').addEventListener('click', () => openURL('https://twitter.com/YOUR_USERNAME'));
    </script>
  </body>
</html>
